# KVM虚拟机
## KVM简单介绍

KVM（Kernel-based Virtual Machine），翻译过来就是内核级的虚拟化机器。原本是由以色列人发明的，之后被RedHat收购了（这里其实没咋搞懂，它收购的是KVM这项技术还是一个叫KVM的公司呀？）。KVM在Linux 2.6.20之后被写入内核，并且应用与各大Linux发行版本中。可以用`uname -r`命令来查看自己的内核版本，我的是5.8.0-48-generic，也就是说我的操作系统中已经自带了KVM模块了。

## KVM与Qeum

前面讲过，KVM是Linux内核中的模块，需要调用CPU。但一来只提供了模拟了CPU和内存的功能，二来用户也不可能直接去调用内核模块。所以要实现一项完整的虚拟化技术就需要用到别的工具，这个工具就是Qeum，Qemu个模拟器，可以模拟除CPU和内存以外的的其他设备（如IO设备），KVM将Qemu中的一部分整合进来，实现了完整的服务器虚拟化和用户层面的调用。所以KVM-Qemu就诞生了。

## KVM与Libvirt

libvirt是管理KVM的工具，就是提供类似于创建虚拟机，删除虚拟机这样的指令，libvirt里用的是virsh。我的感觉就是跟conda,pip这种指令差不多，只不过一个是管理Python包的，一个是管理虚拟机的。其实前面提到的KVM-Qemu已经实现了对虚拟机管理的功能了（毕竟已经可以运行在用户空间了）。但使用Qemu操作比较繁琐，效率不高。所以就出现了Libvirt（据说也是RedHat推出的）。

## 全虚拟和半虚拟

 - 全虚拟化 

无需更改客户机系统内核，相当于完全模拟出一个新的系统（包括各种硬件）， 客户机本身并不知道自己运行在一个虚拟的环境中。

 - 半虚拟化

需更改客户机系统内核，guest可以意识到自己运行在一个虚拟的环境中,一般来说，半虚拟化技术的性能要由于全虚拟化


## KVM与其他虚拟技术比较

现在市面常见的虚拟化产品有：

- VMware 全虚拟  
VMware是一套比较完整的虚拟化技术体系，分为ESXi(虚拟机监控程序)和vSphere(虚拟化平台)。VMware Workstation好像跟这个是两种产品，VMware Workstation是针对于桌面环境的，也就是需要运行在某个操作系统之上。
   - 优点：  
       - 开发时间早，技术比较成熟
       - 功能非常齐全
       - 运行时比较稳定
       - VMware ESXi直接安装在硬件之上，无需依赖原生操作系统（有很多人强调这一个优点，但我还不太清楚到底有什么优势）
   - 缺点：
       - 付费软件，存在授权问题，还有人提到在虚拟Windows系统的需要支付许可费用（这里我不太清楚，不是可以直接下载镜像吗？）
       - 存在硬件兼容的问题  

- Xen 半虚拟和全虚拟
    - 优点：
        - 开源
        - 在半虚拟化模式下，可在无虚拟化支持的CPU上运行
        - 可以直接使用CPU的资源，性能较好
    - 缺点：
        - 操作比较复杂，更新Xen版本是要编译整个内核，容易出错崩溃

- KVM 全虚拟
    - 优点：
        - 开源免费，成本较低
        - 小巧，内置在Linux内核当中，能将 Linux 内核转变成可以实现虚拟化的虚拟机监控程序
        - 性能方面，如果是虚拟Windows的话，KVM还是比较有优势的，Redhat有免费的针对windows优化过的磁盘和网络的驱动程序（这个具体的操作还不了解）。
    - 缺点：
        - 可移植性不太高，目前只能运行在Linux操作系统之上，但这个对我们就无所谓了。
        - 只可在具有虚拟化支持的CPU上运行


## 安装KVM